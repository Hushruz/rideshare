{% extends "layout.html" %}

{% block title %}Ride{% endblock %}

{% block head %}
<link rel="stylesheet" href="static/jquery.dataTables.css" type="text/css" media="screen" />
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-15355461-1");
        pageTracker._trackPageview();
    } catch(err) {

    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB15X6ti6tDQUQKjwPCI2zi3XFfxZW3MGM&sensor=false" type="text/javascript"></script>
<script type="text/javascript">

</script>
{% endblock %}

{% block main %}
<div id="alert_container"></div>
<div>
<div class="alert alert-success">
    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
    <strong>Instructions</strong>
    <p>You can create an event or ride by clicking on the map or typing an address in.</p>
    <hr>
    <p>Check out the existing ride table below to join a ride.</p>
</div>
<div class="row">
    <div class="col-md-8 map_con" id='col_map'>
        <div id="map_canvas"></div>
    </div>
    <div class="col-md-4 map_con" id='col_dialog' data-route='select_location'>
        <div>
            <p>Click anywhere on the map to create a destination or starting point. You may want to zoom in first. You can add yourself to a ride by clicking on one of the red or green pushpins on the map.
            <br><br>
            Enter an address or filter the pushpins by date using the controls on the right.
            <br>
           </p>
        </div>
        <div>
            <form id='search_form'>
                <div class="form-group" >
                    <label>Enter an address or city, state to create a ride:</label>
                    <input type="text" class="form-control" name="address">
                </div>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>
    </div>
    <div class="col-md-4 map_con" data-route='trip_type'>
        <p>Are you creating a new event or an indivudal ride?</p>
        <button class="btn btn-primary" data-next="event_details" type='button'>
            New Event
        </button>
        <button class="btn btn-primary" data-next='passenger_type' type='button'>
            Individual Ride
        </button>
        <hr>
        <button class="btn btn-default">Back</button>
    </div>
    <div class="col-md-4" data-route='event_details'>
        <form data-send="event">
            <div class="form-group">
                <label>Event Name</label>
                <input class="form-control" type="text" placeholder="Name" name='name'>
            </div>
            <div class="form-group">
                <label>Date</label>
                <input class="form-control date-select" type="text" placeholder="Date" name='date'>
            </div>
            <div class="form-group">
                <label>Time</label>
                <input class="form-control" type="text" placeholder="Time" name='time'>
            </div>
            <div class="form-group">
                <label>Details</label>
                <input class="form-control" type="text" placeholder="Details" name='details'>
            </div>
            <!-- <div class="form-group">
                <label>Circle</label>
                <select class="form-control" >
                    <option>All</option>
                </select>
            </div> -->
            <button type='submit' class='btn btn-primary'>Create Event</button>
        </form>
    </div>
    <div class="col-md-4" data-route='passenger_type'>
        <p>Do you need a ride or can you drive?</p>
        <button class="btn btn-primary" data-next='location_1' data-ride='passenger'>
            Need a Ride
        </button>
        <button class="btn btn-primary" data-next='location_1' data-ride='driver'>
            Driving
        </button>
    </div>
    <div class="col-md-4" data-route='passenger_details'>
        <form data-send="passenger">
            <div class="form-group">
                <label>Date</label>
                <input class="form-control date-select" type="text" placeholder="Date" name='date'>
            </div>
            <div class="form-group">
                <label>Time</label>
                <input class="form-control" type="text" placeholder="Time" name='time'>
            </div>
            <div class="form-group">
                <label>Additional Details</label>
                <input class="form-control" type="text" placeholder="Details" name='details'>
            </div>
            <button class="btn btn-primary" type='submit'>
                Ask for Ride
            </button>
        </form>
    </div>
    <div class="col-md-4" data-route='location_1'>
        <form>
            <p class="lead">Is this the starting or ending point?</p>
            <div class="form-group" >
                <label>Location #1:
                    <span data-ride="loc_1"></span>
                </label>
                <select class='form-control' data-ride="loc_1_type" name="location">
                    <option value="destination">Destination</option>
                    <option value="origin">Starting Point</option>
                </select>
            </div>
            <button class="btn btn-primary" data-next="location_2" type='button'>
                Next
            </button>
        </form>
    </div>
    <div class="col-md-4" data-route='location_2'>
        <form>
            <p class="lead">
                Select the 
                <span data-ride="loc_2_type"></span>
            </p>
            <div class="form-group" >
                <label>Location #2:
                    <span data-ride="loc_2"></span>
                </label>

            </div>
            <button class="btn btn-primary" data-next="details" type='button' disabled='disabled' data-ride="loc_btn">
                Next
            </button>
        </form>
    </div>
    <div class="col-md-4" data-route='driver_details'>
        <form id='ride_form'>
            <p class="lead">Give us additional details</p>
            <div class="form-group">
                <label>Max Passengers</label>
                <select class="form-control" name='max_passengers'>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                </select>
            </div>
            <div class="form-group">
                <label>Date</label>
                <input class="form-control date-select" type="text" placeholder="Date" name='date'>
            </div>
            <div class="form-group">
                <label>Time</label>
                <input class="form-control" type="text" placeholder="Time" name='time'>
            </div>
            <div class="form-group">
                <label>Additional Details</label>
                <input class="form-control" type="text" placeholder="Details" name='details'>
            </div>
            <button class="btn btn-primary" data-send="ride" type='button'>
                Create Ride
            </button>
        </form>
    </div>
    <div class="col-md-4" data-route="join_ride">
        
    </div>
    <div data-loading class='col-md-4 hidden'>
        <div class="spinner">
            <div class="double-bounce1"></div>
            <div class="double-bounce2"></div>
        </div>
    </div>

</div>
</div>
<div class="row table-responsive">
    <div id='table'>
        
    </div>
</div>
{% endblock %}

{% block scripts %}
{% raw %}
<script data-template='join_ride' type="text/x-handlebars-template">
    <h1>Join a ride</h1>
    <div class="entry">
        <strong>Origin:</strong>: {{origin}}
    </div>
    <div class="entry">
        <strong>Destination:</strong> {{dest}}
    </div>
    <div class="entry">
        <strong>Date:</strong> {{date}}
    </div>
    <div class="entry">
        <strong>Time:</strong> {{time}}
    </div>
    <div class="entry">
        <strong>Driver:</strong> {{driver}}
    </div>
    <div class="entry">
        <strong>Driver contact:</strong> {{contact}}
    </div>
</script>
<script id="ride_template" type="text/x-handlebars-template">
<hr>
<h1>Existing Rides</h1>
{{#if rides}}
    <table class='table'>
        <tr>
            <th>Driver</th>
            <th>Origin</th>
            <th>Destination</th>
            <th>Spots available</th>
            <th>Date</th>
            <th>Phone #</th>
            <th>Options</th>
        </tr>
        {{#each rides}}
            <tr>
                <td>
                    {{#if driver}}
                        {{driver_name}}
                    {{else}}
                        No Driver
                    {{/if}}
                </td>
                <td>
                    {{origin_add}}
                </td>
                <td>
                    {{dest_add}}
                </td>
                <td>
                    {{passengers_max}}
                </td>
                <td>
                    {{date}}
                </td>
                <td>
                    {{contact}}
                </td>
                <td>
                    <button data-join-ride="" class='btn btn-primary'>Show ride on map</button>
                </td>
            </tr>
        {{/each}}
    </table>
{{else}}
    <p>There are no rides currently</p>
{{/if}}
</script>
<script id="location_template" type="text/x-handlebars-template">
    <p><strong>{{type}}</strong></p>
    <p><strong>Location:</strong> {{location}}</p>
    <button class='btn btn-primary' data-next='join_ride' data-id='{{id}}'>Join this ride</button>
</script>
<script id="event-template" type="text/x-handlebars-template">

</script>
<script id='alert_template' type='text/x-handlebars-template'>
    <div class="alert alert-{{type}} alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <strong>{{strong}}</strong> {{message}}
    </div>
</script>
{% endraw %}

<script src="static/augment.js" type="text/javascript"></script>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script src="static/maps.js" type="text/javascript"></script>
<script src="static/flow.js" type="text/javascript"></script>


<script type="text/javascript">
// if(window.attachEvent) {
//     window.attachEvent('onload', yourFunctionName);
// } else {
//     if(window.onload) {
//         var curronload = window.onload;
//         var newonload = function() {
//             curronload();
//             initialize('{{message}}')
//         };
//         window.onload = newonload;
//     } else {
//         window.onload = initialize('{{message}}');
//     }
// }
function detectBrowser() {
  var useragent = navigator.userAgent;
  var mapdiv = document.getElementById("map_canvas");

  if (useragent.indexOf('iPhone') != -1 || useragent.indexOf('Android') != -1 ) {
    mapdiv.style.width = '100%';
    mapdiv.style.height = '100%';
  } else {
    mapdiv.style.width = '600px';
    mapdiv.style.height = '800px';
  }
}
var map = new Map();
var flow = new Flow();
map.set_flow(flow);
flow.set_map(map);
$('#event-date').datepicker();
$('.date-select').datepicker();
</script>
{% endblock %}