{% extends "layout.html" %}

{% block title %}Ride{% endblock %}

{% block head %}
<link rel="stylesheet" href="/static/datepicker.css">
{% endblock %}

{% block main %}

{% include 'includes/circle_header.html' %}

<div data-notify="container"></div>

{% if circle %}
<div class="panel panel-primary padding">
    <div class="panel-body">
        You are currently viewing the events and rides for <a href='/circle/{{circle.key().id()}}'>{{circle.name}}</a> circle. Any rides or events created will only be visible to this circle.
    </div>
</div>
{% endif %}

<div class="panel panel-default padding">
    <div class="panel-body">
        
        <div class="key">
            <i class='fa fa-key'></i>
            Key
        </div>
        <div class="key">
            <img src="/static/person.png" />
            Event
        </div>
        <div class="key">
            <img src="/static/start.png" />
            Starting point
        </div>
        <div class="key">
            <img src="/static/end.png" />
            Destination
        </div>
        <div class="btn-group pull-right">
            <button class='btn btn-primary' data-reset>
                <i class="fa fa-tencent-weibo"></i>
                Start over
            </button>
            <button class='btn btn-primary' data-help='toggle'>
                <i class="fa fa-navicon"></i>
                Help
            </button>
        </div>

    </div>
</div>

{% include 'help_map.html' %}

<div class="row">

    <div class="col-md-8 map-container" id='col_map'>
        <div id="map_canvas"></div>
    </div>

    <div class="col-md-4" data-route='path'>
        To get started, <b>click on a marker to get details</b> or
        <ul class="menu">
            <li data-next='new_event'>Create a new Event</li>
            <li data-next='new_ride'>Request a Ride</li>
            <li data-next='new_trip'>Create a new Trip</li>
        </ul>
    </div>

    <div class="col-md-4 hidden" data-route='select_orig'>
        <div class="locsec">
            <h1>Select the <span data-location='first'>starting</span> location</h1>
            <hr>
            <h3>
                Location:
                <span data-location='text'>
                    Not Selected
                </span>
            </h3>
            <button class="btn btn-success btn-lg hidden" data-next="true" type='button' data-location="btn">
                Next
            </button>
            <hr>
            <p>Use one of the following options:</p>
            <ul>
                <li>
                    <h2>Point & Click</h2>
                    Zoom in to select an exact location by clicking on the map
                </li>
                <li data-geolocation='container' class='hidden'>
                    <h2>Geolocation</h2>
                    <button data-geolocation='btn' class='btn btn-primary'>Use your current location.</button>
                </li>
                <li>
                    <h2>Search</h2>
                    <form data-search>
                        <div class="form-group">
                            <label>Enter an address, city, or state:</label>
                            <input type="text" class="form-control" name="address">
                        </div>
                        <button type="submit" class="btn btn-primary">Search</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>

    <div class="col-md-4 hidden" data-route='event_details'>
        <form data-send="event">
            <div class="form-group">
                <label>Event Name</label>
                <input class="form-control" type="text" placeholder="Name" name='name'>
            </div>
            <div class="form-group">
                <label>Date</label>
                <div class='input-group date' data-datepicker data-date-format="MM/DD/YYYY">
                    <input class="form-control" type="text" placeholder="Date" name='date'>
                    <span class="input-group-addon">
                        <i class="fa fa-calendar"></i>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <label>Time</label>
                <div class="input-group date" data-time>
                    <input class="form-control" type="text" placeholder="Time" name='time'>
                    <span class="input-group-addon">
                        <i class="fa fa-clock-o"></i>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <label>Details</label>
                <input class="form-control" type="text" placeholder="Details" name='details'>
            </div>
            <button type='submit' class='btn btn-primary'>Create Event</button>
        </form>
    </div>

    <div class="col-md-4 hidden" data-route='passenger_details'>
        <form data-send="passenger">
            <div class="form-group">
                <label>Date</label>
                <div class='input-group date' data-datepicker data-date-format="MM/DD/YYYY">
                    <input class="form-control" type="text" placeholder="Date" name='date'>
                    <span class="input-group-addon">
                        <i class="fa fa-calendar"></i>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <label>Time</label>
                <div class="input-group date" data-time>
                    <input class="form-control" type="text" placeholder="Time" name='time'>
                    <span class="input-group-addon">
                        <i class="fa fa-clock-o"></i>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <label>Additional Details</label>
                <input class="form-control" type="text" placeholder="Details" name='details'>
            </div>
            <button class="btn btn-primary" type='submit'>
                Ask for Ride
            </button>
        </form>
    </div>

    <div class="col-md-4 hidden" data-route='select_dest'>
        <form>
            <p class="lead">
                Select the Destination
            </p>
            <hr>
            <h3>
                Destination Location:
                <span data-ride="loc_dest">
                    Not Selected
                </span>
            </h3>
            <button class="btn btn-success btn-lg hidden" data-next="details" type='button' data-ride="loc_btn">
                Next
            </button>
            <hr>
            <form data-search>
                <div class="form-group">
                    <label>Enter an address, city, or state:</label>
                    <input type="text" class="form-control" name="address">
                </div>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
            <hr>
        </form>
    </div>

    <div class="col-md-4 hidden" data-route='driver_details'>
        <form data-send="ride">
            <p class="lead">Give us additional details</p>
            <div class="form-group">
                <label>Max Passengers</label>
                <select class="form-control" name='max_passengers'>
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                </select>
            </div>
            <div class="form-group">
                <label>Date</label>
                <div class='input-group date' data-datepicker data-date-format="MM/DD/YYYY">
                    <input class="form-control" type="text" placeholder="Date" name='date'>
                    <span class="input-group-addon">
                        <i class="fa fa-calendar"></i>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <label>Time</label>
                <div class="input-group date" data-time>
                    <input class="form-control" type="text" placeholder="Time" name='time'>
                    <span class="input-group-addon">
                        <i class="fa fa-clock-o"></i>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <label>Additional Details</label>
                <input class="form-control" type="text" placeholder="Details" name='details'>
            </div>
            <div class='form-group'>
                <label>Are you the person driving this ride?</label>

                <select class="form-control" data-driver='select'>
                    <option value="">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            <div class='form-group' data-driver='form'>
                <label>Enter the driver's name:</label>
                <input class='form-control' type="text" name='driven_by' placeholder='Driven by' data-driver='input'>
            </div>
            <div class="form-group hidden">
                <label>Does this event recur?</label>
                <select name="recurring" class="form-control">
                    <option value="false">Never</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                </select>
            </div>
            <button class="btn btn-primary"  type='submit'>
                Create Trip
            </button>
        </form>
    </div>

    <div class="col-md-4" data-route='safety'>
        <p>This is a safety agreement that you have agreed to follow. This is important.</p>
        <button class='btn btn-primary' data-next='true'>Agree & Continue</button>
    </div>
</div>
{% endblock %}

{% block scripts %}

{% raw %}

<script data-template='popup' type="text/x-handlebars-template">
    <div class="entry">
        This is the: <strong>{{primary}}</strong> point.
    </div>
    <div class="entry">
        <strong>{{primary}} Location:</strong> {{primary_add}}
    </div>
    <div class="entry">
        <strong>{{secondary}} Location:</strong> {{secondary_add}}
    </div>
    <a class='btn btn-primary' href='/ride/{{id}}'>View more details</a>
</script>

<script data-template='popup-event' type="text/x-handlebars-template">
    <div class="entry">
        This is an <strong>event</strong>.
    </div>
    <div class="entry">
        <strong>Location:</strong> {{add}}
    </div>
    <div class="entry">
        <strong>Date:</strong> {{date}}
    </div>
    <a class='btn btn-primary' href='/event/{{id}}'>
        View Event
    </a>
    <a href='/event/{{id}}' class='btn btn-primary'>
        Create a ride to this event.
    </a>
    <p class="help-block">View the event to look for rides / set up rides.</p>
</script>

<script data-notify="template" type='text/x-handlebars-template'>
    <div class="alert alert-{{type}} alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <strong>{{strong}}</strong> {{message}}
    </div>
</script>

{% endraw %}
<script type="text/javascript">
    {% if active_circle == None %}
        var circle = false;
    {% else %}
        var circle = {{active_circle.key().id()}}
    {% endif %}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB15X6ti6tDQUQKjwPCI2zi3XFfxZW3MGM&sensor=false" type="text/javascript"></script>
<script src="/static/maps2.js" type="text/javascript"></script>
<script src="/static/flow2.js" type="text/javascript"></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/moment.js/2.7.0/moment.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.0.0/js/bootstrap-datetimepicker.min.js'></script>
<script src='//cdnjs.cloudflare.com/ajax/libs/ember.js/1.7.0/ember.min.js'></script>

<script type="text/javascript">

    var app = Ember.Application.create()

    $('[data-datepicker]').datetimepicker({
        pickTime: false
    });

    $('[data-time]').datetimepicker({
        icons: {
            time: "fa fa-clock-o",
            date: "fa fa-calendar",
            up: "fa fa-arrow-up",
            down: "fa fa-arrow-down"
        },
        pickDate: false
    });

    var flow = new Flow('path', paths);
    flow.set_handler(map);

    /* Toggle Help */
    var help = {};
    help.btn = document.querySelector('[data-help="toggle"]');
    help.container = document.querySelector('[data-help="container"]');

    help.btn.addEventListener('click', function (e) {
        var target = e.target;

        help.container.classList.toggle('hidden');
    });
    /* End */

    var if_driving = {
        form: document.querySelector('[data-driver="form"]'),
        select: document.querySelector('[data-driver="select"]'),
        input: document.querySelector('[data-driver="input"]')
    }

    if_driving.form.classList.add('hidden');

    if_driving.select.addEventListener('change', function (e) {
        var target = e.target;

        if (target.value == 'no') {
            if_driving.form.classList.remove('hidden');
        } else {
            if_driving.form.classList.add('hidden');
            if_driving.input.value = '';
        }
    });
</script>

{% endblock %}